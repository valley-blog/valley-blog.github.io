---
layout: default
---
<article class="post">
  <h1 class="post-title">{{ page.title }}</h1>
  <div class="post-meta">
    <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%Y-%m-%d" }}</time>
    {% if page.author or site.author.name %} · <span>{{ page.author | default: site.author.name }}</span>{% endif %}
  </div>
  <div class="post-content">
    {{ content }}
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 改进的标题点击隐藏功能
      const headings = document.querySelectorAll('.post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6');
      
      headings.forEach(heading => {
        heading.style.cursor = 'pointer';
        heading.title = '点击隐藏/显示内容';
        
        // 添加状态指示器
        const indicator = document.createElement('span');
        indicator.innerHTML = ' ▼';
        indicator.style.fontSize = '0.7em';
        indicator.style.color = 'var(--accent)';
        heading.appendChild(indicator);
        
        heading.addEventListener('click', function() {
          const indicator = this.querySelector('span');
          let nextElement = this.nextElementSibling;
          let hasContent = false;
          
          // 找到所有需要隐藏的内容直到下一个同级或更高级标题
          const targetLevel = parseInt(this.tagName.charAt(1));
          let elementsToToggle = [];
          
          while (nextElement) {
            if (nextElement.matches('h1, h2, h3, h4, h5, h6')) {
              const nextLevel = parseInt(nextElement.tagName.charAt(1));
              if (nextLevel <= targetLevel) {
                break; // 遇到同级或更高级标题时停止
              }
            }
            elementsToToggle.push(nextElement);
            nextElement = nextElement.nextElementSibling;
          }
          
          // 如果有内容可隐藏
          if (elementsToToggle.length > 0) {
            const isHidden = elementsToToggle[0].style.display === 'none';
            
            elementsToToggle.forEach(element => {
              element.style.display = isHidden ? '' : 'none';
            });
            
            // 更新指示器
            indicator.innerHTML = isHidden ? ' ▼' : ' ▶';
            this.style.opacity = isHidden ? '1' : '0.7';
            hasContent = true;
          }
          
          // 如果没有内容可隐藏，给出视觉反馈
          if (!hasContent) {
            this.style.backgroundColor = 'rgba(0, 102, 204, 0.1)';
            setTimeout(() => {
              this.style.backgroundColor = '';
            }, 200);
          }
        });
      });
      
      // 重新设计的列表隐藏功能 - 标记显示在上一行
      const lists = document.querySelectorAll('.post-content ul, .post-content ol');
      
      lists.forEach(list => {
        // 只为顶级列表添加隐藏功能，避免嵌套列表重复
        const isNested = list.closest('li') !== null;
        const hasMarker = list.previousElementSibling && list.previousElementSibling.querySelector && list.previousElementSibling.querySelector('.list-toggle-prev');
        
        if (!isNested && !hasMarker) {
          // 找到列表的前一个兄弟元素（通常是段落或标题）
          let prevElement = list.previousElementSibling;
          
          // 如果前一个元素是文本节点或空白，继续向前找
          while (prevElement && prevElement.nodeType === 3) {
            prevElement = prevElement.previousElementSibling;
          }
          
          // 如果找到合适的元素，将标记添加到其末尾
          if (prevElement && (prevElement.tagName === 'P' || prevElement.tagName.match(/^H[1-6]$/))) {
            // 创建切换标记
            const toggleMarker = document.createElement('span');
            toggleMarker.innerHTML = ' ▼';
            toggleMarker.className = 'list-toggle-prev';
            toggleMarker.style.cursor = 'pointer';
            toggleMarker.style.color = 'var(--accent)';
            toggleMarker.style.fontSize = '0.7em';
            toggleMarker.style.marginLeft = '6px';
            toggleMarker.style.verticalAlign = 'middle';
            toggleMarker.style.opacity = '0';
            toggleMarker.style.transition = 'opacity 0.2s ease';
            toggleMarker.title = '点击隐藏/显示列表';
            
            // 将标记添加到前一个元素的末尾
            prevElement.appendChild(toggleMarker);
            
            // 为前一个元素添加鼠标悬停事件
            prevElement.addEventListener('mouseenter', function() {
              toggleMarker.style.opacity = '1';
            });
            
            prevElement.addEventListener('mouseleave', function() {
              toggleMarker.style.opacity = '0';
            });
            
            // 添加点击事件
            toggleMarker.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              
              const targetList = list;
              if (targetList.style.display === 'none') {
                targetList.style.display = '';
                this.innerHTML = ' ▼';
                this.style.opacity = '1';
              } else {
                targetList.style.display = 'none';
                this.innerHTML = ' ▶';
                this.style.opacity = '0.6';
              }
            });
          } else {
            // 如果没有找到前一个元素，创建一个新的段落来放置标记
            const markerParagraph = document.createElement('p');
            markerParagraph.style.margin = '8px 0';
            markerParagraph.style.fontSize = '0.9em';
            markerParagraph.style.color = 'var(--muted)';
            
            const toggleMarker = document.createElement('span');
            toggleMarker.innerHTML = '列表 ▼';
            toggleMarker.className = 'list-toggle-prev';
            toggleMarker.style.cursor = 'pointer';
            toggleMarker.style.color = 'var(--accent)';
            toggleMarker.style.fontSize = '0.7em';
            toggleMarker.style.marginRight = '6px';
            toggleMarker.style.verticalAlign = 'middle';
            toggleMarker.style.opacity = '0';
            toggleMarker.style.transition = 'opacity 0.2s ease';
            toggleMarker.title = '点击隐藏/显示列表';
            
            markerParagraph.appendChild(toggleMarker);
            
            // 插入到列表前面
            list.parentNode.insertBefore(markerParagraph, list);
            
            // 为标记段落添加鼠标悬停事件
            markerParagraph.addEventListener('mouseenter', function() {
              toggleMarker.style.opacity = '1';
            });
            
            markerParagraph.addEventListener('mouseleave', function() {
              toggleMarker.style.opacity = '0';
            });
            
            // 添加点击事件
            toggleMarker.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              
              const targetList = list;
              if (targetList.style.display === 'none') {
                targetList.style.display = '';
                this.innerHTML = '列表 ▼';
                this.style.opacity = '1';
              } else {
                targetList.style.display = 'none';
                this.innerHTML = '列表 ▶';
                this.style.opacity = '0.6';
              }
            });
          }
        }
      });
      
      // URL自动识别和转换功能
      function autoLinkUrls() {
        const postContent = document.querySelector('.post-content');
        if (!postContent) return;
        
        // 正则表达式匹配URL
        const urlRegex = /(https?:\/\/[^\s\u4e00-\u9fa5]+)/g;
        
        // 递归处理文本节点
        function processTextNode(node) {
          if (node.nodeType === 3) { // 文本节点
            const text = node.textContent;
            const matches = [...text.matchAll(urlRegex)];
            
            if (matches.length > 0) {
              const fragment = document.createDocumentFragment();
              let lastIndex = 0;
              
              matches.forEach(match => {
                const url = match[1];
                const index = match.index;
                
                // 添加URL前的文本
                if (index > lastIndex) {
                  fragment.appendChild(document.createTextNode(text.slice(lastIndex, index)));
                }
                
                // 创建链接元素
                const link = document.createElement('a');
                link.href = url;
                link.textContent = url;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                
                fragment.appendChild(link);
                lastIndex = index + url.length;
              });
              
              // 添加剩余文本
              if (lastIndex < text.length) {
                fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
              }
              
              // 替换原节点
              node.parentNode.replaceChild(fragment, node);
              return true;
            }
          } else if (node.nodeType === 1) { // 元素节点
            // 跳过已经存在的链接和代码块
            if (node.tagName === 'A' || node.tagName === 'CODE' || node.tagName === 'PRE') {
              return false;
            }
            
            // 递归处理子节点
            const children = Array.from(node.childNodes);
            let modified = false;
            children.forEach(child => {
              if (processTextNode(child)) {
                modified = true;
              }
            });
            return modified;
          }
          return false;
        }
        
        processTextNode(postContent);
      }
      
      // 页面加载完成后执行URL自动识别
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', autoLinkUrls);
      } else {
        autoLinkUrls();
      }
      const postContent = document.querySelector('.post-content');
      if (postContent) {
        let allHidden = false;
        
        postContent.addEventListener('dblclick', function(e) {
          if (e.target.tagName === 'H1' || e.target.tagName === 'H2' || e.target.tagName === 'H3' || 
              e.target.tagName === 'H4' || e.target.tagName === 'H5' || e.target.tagName === 'H6') {
            
            const allElements = this.querySelectorAll('p, ul, ol, blockquote, pre, table, img');
            
            allElements.forEach(element => {
              element.style.display = allHidden ? '' : 'none';
            });
            
            // 更新所有指示器
            const indicators = this.querySelectorAll('h1 span, h2 span, h3 span, h4 span, h5 span, h6 span');
            indicators.forEach(indicator => {
              indicator.innerHTML = allHidden ? ' ▼' : ' ▶';
            });
            
            // 更新标题透明度
            const headings = this.querySelectorAll('h1, h2, h3, h4, h5, h6');
            headings.forEach(heading => {
              heading.style.opacity = allHidden ? '1' : '0.7';
            });
            
            allHidden = !allHidden;
          }
        });
      }
    });
  </script>
  {% if page.tags %}
  <div class="post-tags">
    <span>标签：</span>
    {% for tag in page.tags %}
      <a href="{{ '/tags/#' | relative_url }}{{ tag | uri_escape }}" class="tag">#{{ tag }}</a>
    {% endfor %}
  </div>
  {% endif %}
  <hr/>
  <div class="post-nav">
    {% if page.previous.url %}
      <a class="prev" href="{{ page.previous.url | relative_url }}">&larr; {{ page.previous.title }}</a>
    {% endif %}
    {% if page.next.url %}
      <a class="next" href="{{ page.next.url | relative_url }}">{{ page.next.title }} &rarr;</a>
    {% endif %}
  </div>
</article>
